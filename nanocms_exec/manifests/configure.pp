# Class: nanocms
#
#
class nanocms_exec::configure {
  $leaked_filenames = ['flagtest'] ##$secgen_parameters['leaked_filenames']
  $strings_to_leak = ['this is a list of strings that are secrets / flags','another secret'] ##$secgen_parameters['strings_to_leak']
  $known_username = 'admin' ##$secgen_parameters['known_username'][0]
  $known_password = 'demo' ##$secgen_parameters['known_password'][0]
  $strings_to_pre_leak =  ['The username is admin', 'The password is demo'] ##$secgen_parameters['strings_to_pre_leak']
  $web_pre_leak_filename = 'PRELEAK_NAME' ##$secgen_parameters['web_pre_leak_filename'][0]

  if $strings_to_pre_leak.length != 0 {
    file{ "/var/www/nanocms/${web_pre_leak_filename}":
      ensure  => file,
      content => template('nanocms_exec/pre_leak.erb')
    }
  }

  Exec { path => ['/bin', '/usr/bin', '/usr/local/bin', '/sbin', '/usr/sbin'] }

  ::secgen_functions::leak_files { 'nanocms-flag-leak':
    storage_directory => '/var/www/nanocms/',
    leaked_filenames  => $leaked_filenames,
    strings_to_leak   => $strings_to_leak,
    owner             => 'www-data',
    mode              => '0750',
    leaked_from       => 'nanocms_exec',
  }
}
