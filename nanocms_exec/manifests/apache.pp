# Class: nanocms::apache
# Configures the apache resources
#
class nanocms_exec::apache {
  $port = '80'
  $docroot = '/var/www/nanocms'

  Exec { path => ['/bin', '/usr/bin', '/usr/local/bin', '/sbin', '/usr/sbin'] }

  # TODO: Check this - testing didnt remove file
  # delete's a file that we don't want there
  # ensure_resource('tidy','nanocms remove default', {'path'=>'/etc/apache2/sites-enabled/000-default.conf'})
  # Ensure resource didnt work - we will use this temporarily.
  exec { 'remove-default-site':
    command   => 'rm /etc/apache2/sites-enabled/000-default.conf',
    logoutput => true
  }

  class { '::apache':
    default_vhost   => false,
    default_mods    => ['rewrite'], # php5 via separate module
    overwrite_ports => false,
    mpm_module      => 'prefork'
  }

  -> ::apache::vhost { 'nanocms':
    port    => $port,
    docroot => $docroot,
  }

  # restart apache
  -> exec { 'restart-apache-nanocms':
    command   => 'service apache2 restart',
    logoutput => true
  }
  -> exec { 'wait-apache-nanocms':
    command => 'sleep 4',
  }
}
