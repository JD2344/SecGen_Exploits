# Class: nanocms
# Install Process for nanocms
#
class nanocms_exec::install {
  Exec { path => [ '/bin/', '/sbin/' , '/usr/bin/', '/usr/sbin/' ] }

  # check php installed
  ensure_packages(['php'], { ensure => 'installed'})

  $releasename = 'nanocms_exec'
  file { "/var/www/${releasename}.zip":
    ensure => file,
    source => "puppet:///modules/nanocms_exec/${releasename}.zip"
  }
  -> exec { 'unpack-nanocms':
    cwd     => '/var/www/',
    command => ["unzip ${releasename} -d /var/www/", "rm /var/www/${releasename}.zip"],
    creates => "/var/www/${releasename}"
  }
  -> exec { 'set-perms-nanocms':
    command => ['chmod -R 777 /var/www/data/pages /var/www/data/areas', 'chown -R www-data /var/www/*'],
  }
}
