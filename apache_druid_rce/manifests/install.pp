# Class: apache_druid_rce::install
# Install process for apache druid RCE
#
class apache_druid_rce::install {
  Exec { path => [ '/bin/', '/sbin/' , '/usr/bin/', '/usr/sbin/' ] }

  file { '/etc/apt/sources.list.d/stretch.list':
    ensure => file,
    source => 'puppet:///modules/apache_druid_rce/stretch.list'
  }

  # openjdk8 is required. Since we are buster, we need the repos within stretch for this
  ensure_packages(['openjdk-8-jdk'], { ensure => 'installed'})

  $releasename = 'apache_druid-0.20.0-bin'
  file { "/tmp/${releasename}.tar.gz":
    ensure => file,
    source => "puppet:///modules/apache_spark_rce/${releasename}.tar.gz",
  }
  -> exec { 'unpack-druid':
    cwd     => '/tmp',
    command => "tar -xf ${releasename}",
  }
  -> exec { 'move-druid':
    cwd     => '/tmp',
    command => 'mv apache_druid-0.20.0 /usr/local/apache-druid',
  }
}
