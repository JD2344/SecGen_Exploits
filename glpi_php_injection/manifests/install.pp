# Class: glpi_php_injection::install
# Install process for GLPI 
#
class glpi_php_injection::install {
  Exec { path => [ '/bin/', '/sbin/' , '/usr/bin/', '/usr/sbin/' ] }

  $packages = ['mariadb-server', 'apache2']

  ensure_packages($packages, 'php',
  'php-curl',
  'php-gd',
  'php-intl',
  'php-mysql',
  'php-mbstring',
  'php-xml', { ensure => 'installed'})

  $packages.each |String $package| {
    service { $package:
      ensure => 'running',
    }
  }

  $releasename = 'glpi-9.5.8.tgz'
  file { "/tmp/${releasename}":
    ensure => file,
    source => "puppet:///modules/glpi_php_injection/${releasename}",
  }
  -> exec { 'extract-glpi':
    cwd     => '/tmp',
    command => "tar -xf ${releasename}",
    creates => '/tmp/glpi'
  }
  -> exec { 'move-glpi':
    cwd     => '/tmp',
    command => 'mv glpi/ /var/www/html',
    creates => '/var/www/html/glpi/',
  }
  -> exec { 'chmod-glpi':
    command => 'chmod 755 -R /var/www/html/glpi/',
  }
  -> exec { 'chown-glpi':
    command => 'chown www-data:www-data -R /var/www/html/glpi/',
  }

}
