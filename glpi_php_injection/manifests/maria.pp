# Class: glpi_php_injection::maria
# maria db install and configuration
#
class glpi_php_injection::maria {
  Exec { path => [ '/bin/', '/sbin/' , '/usr/bin/', '/usr/sbin/' ] }

  $db_name = 'glpidb'
  $db_user = 'user'

  ::mysql::db { $db_name:
    ensure   => present,
    user     => "${db_user}",
    password => '',
    host     => 'localhost',
  }

  ::mariadb::db_grant { $db_name:
    user   => "${db_user}",
    dbname => $db_name,
  }

  # glpi provides a cli installer - we can utilise this to set it up.
  # See: https://glpi-install.readthedocs.io/en/latest/command-line.html#cdline-install
  # TODO: Check password input - for now we dont set duhh... 
  exec { 'glpi-cli-install':
    cwd => '/var/www/html/glpi/bin/',
    command => "php bin/console db:install -f -d ${dbname} -u ${db_user} -p ${dbpass} -vvv",
    logoutput => true,
  }
}
